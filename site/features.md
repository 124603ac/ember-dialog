---
layout: main
title:  "Features"
date:   2014-12-24 12:25:40
categories: jekyll update
---
## Overview

Library contains 4 parts:

- Менеджер диалоговых окон
- Компонент окна
- Лейауты (для алертов, конфирмов и т.п.)
- Инициализатор, который добавляет менеджера куда надо ;)

### Менеждер диалоговых окон

Менеджер является фасадной частью библиотеки. Его зона ответственности заключается в:

- создании новых окон с нужными опциями и названием
- прикреплении/откреплении контроллера к компоненту окна, для прокидывания событий
- создании нехватающих сущностей для окна (таких как `controller` или `view`)
- контролирует порядок показа и активность мадальных окон (чтобы нужные события попадали только в компонент активного окна)

### Компонент окна

Является конечной точкой получения всех событий, связанных с окном. Таких как нажатия клавиш `enter` и `esc`, клик по кнопкам "YES" и "NO".

### Лейауты

Лейауты используются для создания диалоговых окон, они оборачивают собой view. Предустановленно несколько типов:

- alert layout - с одной `accept` кнопкой
- confirm layout - с двумя кнопками `accept` и `reject`
- notice layout - без кнопок
- custom layout - полностью пустой

### Инициализатор

Создает экземпляр класса `менеджера` и инжектит его всем контроллерам, чтобы можно было дотянуться до него через свойство `dialogManager`.

## Принцип работы & особенности

Диалоговые окна создаются менеджером используя <a href="http://emberjs.com/guides/views/">view</a> и <a href="http://emberjs.com/guides/controllers/">controller</a> объекты, переданные ему. Внутри менеджера создается <a href="http://emberjs.com/guides/components/">компонент</a> диалогового окна, которому назначается view в качестве тела. Объект view использует <a href="http://emberjs.com/guides/views/adding-layouts-to-views/">layout</a> соответствующий типу мадальника: confirm, alert или custom. Контроллер вешается на view, снабжает его данными и предоставляет хендлеры. Затем заполненный компонент вставляется в DOM (в <a href="http://emberjs.com/api/classes/Ember.Application.html#property_rootElement">rootElement</a>). Контроллер начинает слушать события от view.

<img src="./images/schema-1.png" align="right" width="320px" />

Контроллеру на время существования модального окна меняется `target` на компонент диалогового окна. Это означает, что события которые не были пойманы в контроллере уходят в компонент модального окна. Таким образом события accept и decline могут быть перехвачены в контролере, чтобы реализовать логику закрытия модельного окна. Если события `закрытия` (`accept` или `decline`) от модального окна не были перехвачены в контроллере они уходят в компонент, который себя закрывает. На рисунке справа изображен порядок следования событий. Если вы не понимаете о чем идет речь, рекомендую посетить <a href="http://emberjs.com/api/classes/Ember.View.html#toc_event-names">раздел ember документации</a>. Данную особенность можно проиллюстрировать примером.

{% highlight javascript %}
// Находясь в контроллере мы может получить менеджера диалоговых
// окон из параметра `dialogManager`.
var manager = this.get('dialogManager');

// Контроллер указывается вторым параметром
var controller = Ember.Controller.createWithMixin({

    // Любые параметры контроллера, который прикрепляется к диалоговому окну
    // можно использовать в шаблоне.
    name: "Milkov Vladimir",

    // Стандартные хендлеры событий виюшек эмбера
    actions: {
        'keyDown': function (e) {
            // События клавиш можно также перехватить в контроллере и они
            // не дойдут до диалогового окна. Таким образом esc и enter клавиши
            // работать перестанут.
            //
            // Можно перехватывать только enter события, например:
            // if (e.keyCode !== 13) return true
        },
        'accept': function (dialog) {
            if (true) {
                // Позволит событию пойти дальше. Событие попадет в компонент
                // модального окна, который его закроет.
                return true;
            } else {
                // Событие не попадет в компонент модального окна,
                // и окно останется открытым. В этом месте возможно
                // вызвать асинхронную операцию, после которой можно закрыть
                // диалоговое окно вручную: dialog.close();
                return false;
            }
        },
    }
});
manager.confirm("Выше имя \{\{name\}\}?", controller);
{% endhighlight %}

